{
  "version": 3,
  "sources": ["../../@shikijs/monaco/dist/index.mjs"],
  "sourcesContent": ["import { INITIAL, StackElementMetadata } from '@shikijs/core/textmate';\n\nfunction textmateThemeToMonacoTheme(theme) {\n  let rules = \"rules\" in theme ? theme.rules : void 0;\n  if (!rules) {\n    rules = [];\n    const themeSettings = theme.settings || theme.tokenColors;\n    for (const { scope, settings } of themeSettings) {\n      const scopes = Array.isArray(scope) ? scope : [scope];\n      for (const s of scopes) {\n        if (settings.foreground && s) {\n          rules.push({\n            token: s,\n            foreground: normalizeColor(settings.foreground)\n          });\n        }\n      }\n    }\n  }\n  const colors = Object.fromEntries(\n    Object.entries(theme.colors || {}).map(([key, value]) => [key, `#${normalizeColor(value)}`])\n  );\n  return {\n    base: theme.type === \"light\" ? \"vs\" : \"vs-dark\",\n    inherit: false,\n    colors,\n    rules\n  };\n}\nfunction shikiToMonaco(highlighter, monaco) {\n  const themeMap = /* @__PURE__ */ new Map();\n  const themeIds = highlighter.getLoadedThemes();\n  for (const themeId of themeIds) {\n    const tmTheme = highlighter.getTheme(themeId);\n    const monacoTheme = textmateThemeToMonacoTheme(tmTheme);\n    themeMap.set(themeId, monacoTheme);\n    monaco.editor.defineTheme(themeId, monacoTheme);\n  }\n  let currentTheme = themeIds[0];\n  const _setTheme = monaco.editor.setTheme.bind(monaco.editor);\n  monaco.editor.setTheme = (theme) => {\n    _setTheme(theme);\n    currentTheme = theme;\n  };\n  for (const lang of highlighter.getLoadedLanguages()) {\n    if (monaco.languages.getLanguages().some((l) => l.id === lang)) {\n      monaco.languages.setTokensProvider(lang, {\n        getInitialState() {\n          return new TokenizerState(INITIAL, highlighter);\n        },\n        tokenize(line, state) {\n          const tokenizeMaxLineLength = 2e4;\n          const tokenizeTimeLimit = 500;\n          if (line.length >= tokenizeMaxLineLength) {\n            return {\n              endState: state,\n              tokens: [{ startIndex: 0, scopes: \"\" }]\n            };\n          }\n          const grammar = state.highlighter.getLanguage(lang);\n          const { colorMap } = state.highlighter.setTheme(currentTheme);\n          const theme = themeMap.get(currentTheme);\n          const result = grammar.tokenizeLine2(line, state.ruleStack, tokenizeTimeLimit);\n          if (result.stoppedEarly)\n            console.warn(`Time limit reached when tokenizing line: ${line.substring(0, 100)}`);\n          const colorToScopeMap = /* @__PURE__ */ new Map();\n          theme.rules.forEach((rule) => {\n            const c = normalizeColor(rule.foreground);\n            if (c && !colorToScopeMap.has(c))\n              colorToScopeMap.set(c, rule.token);\n          });\n          function findScopeByColor(color) {\n            return colorToScopeMap.get(color);\n          }\n          const tokensLength = result.tokens.length / 2;\n          const tokens = [];\n          for (let j = 0; j < tokensLength; j++) {\n            const startIndex = result.tokens[2 * j];\n            const metadata = result.tokens[2 * j + 1];\n            const color = normalizeColor(colorMap[StackElementMetadata.getForeground(metadata)] || \"\");\n            const scope = findScopeByColor(color) || \"\";\n            tokens.push({\n              startIndex,\n              scopes: scope\n            });\n          }\n          return {\n            endState: new TokenizerState(result.ruleStack, state.highlighter),\n            tokens\n          };\n        }\n      });\n    }\n  }\n}\nclass TokenizerState {\n  constructor(_ruleStack, highlighter) {\n    this._ruleStack = _ruleStack;\n    this.highlighter = highlighter;\n  }\n  get ruleStack() {\n    return this._ruleStack;\n  }\n  clone() {\n    return new TokenizerState(this._ruleStack, this.highlighter);\n  }\n  equals(other) {\n    if (!other || !(other instanceof TokenizerState) || other !== this || other._ruleStack !== this._ruleStack)\n      return false;\n    return true;\n  }\n}\nfunction normalizeColor(color) {\n  if (!color)\n    return color;\n  color = color.replace(\"#\", \"\").toLowerCase();\n  if (color.length === 3 || color.length === 4)\n    color = color.split(\"\").map((c) => c + c).join(\"\");\n  return color;\n}\n\nexport { shikiToMonaco, textmateThemeToMonacoTheme };\n"],
  "mappings": "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",
  "names": []
}
